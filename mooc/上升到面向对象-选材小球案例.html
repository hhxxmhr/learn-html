<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>上升到面向对象-选材小球案例</title>
</head>
<style>
    .ball {
        position: absolute;
        border-radius: 50%;
    }
</style>
<body>
<script>
    function Ball(x, y) {
        // 位置
        this.x = x;
        this.y = y;
        // 半径
        this.r = 20;
        // 背景色,从颜色数组中随机选取一个颜色
        this.color = colorArr[parseInt(Math.random() * colorArr.length)];
        console.log(Math.random() * colorArr.length)
        console.log(this.color)
        // 透明度
        this.opacity = 1;
        this.init();
        // 把自己推入数组;这里的this指的是实例
        ballArr.push(this);
    }

    Ball.prototype.init = function () {
        // 创建自己的dom
        this.dom = document.createElement('div');
        // 设置样式
        this.dom.className = 'ball';
        this.dom.style.left = this.x - this.r + 'px';
        this.dom.style.top = this.y - this.r + 'px';
        this.dom.style.width = this.r * 2 + 'px';
        this.dom.style.height = this.r * 2 + 'px';
        this.dom.style.backgroundColor = this.color;
        this.dom.style.opacity = this.opacity;
        // 坐标的改变值，使用do while语句，可以防止dx和dy都是0
        do {
            this.dx = parseInt(Math.random() * 20) - 10;
            this.dy = parseInt(Math.random() * 20) - 10;
        } while (this.dx === 0 && this.dy === 0)
        // 追加上树
        document.body.appendChild(this.dom);
    }

    Ball.prototype.update = function () {
        // 改变坐标
        this.x += this.dx;
        this.y -= this.dy;
        this.dom.style.left = this.x - this.r + 'px';
        this.dom.style.top = this.y - this.r + 'px';
        // 半径改变
        this.r += 0.2;
        this.dom.style.width = this.r * 2 + 'px';
        this.dom.style.height = this.r * 2 + 'px';
        // 透明的改变
        this.opacity -= 0.01;
        this.dom.style.opacity = this.opacity;

        // 当透明度小于0的时候，就从数组中删除自己，dom元素也要删除自己
        if (this.opacity <= 0) {
            for (let i = 0; i < ballArr.length; i++) {
                if (ballArr[i] === this) {
                    ballArr.splice(i, 1);
                }

            }
            document.body.removeChild(this.dom);
        }

    }
    // 由实例组成的数组
    let ballArr = [];
    // 初始颜色数组
    let colorArr = ['#66CCCC', '#CCFF66', '#FF99CC', '#FF6666', '#CC3399', '#FF6600']

    // 定时器调用实例的update方法
    setInterval(function () {
        for (let i = 0; i < ballArr.length; i++) {
            ballArr[i].update();
        }
    }, 20);
    //  监听鼠标事件
    document.onmousemove = function (ev) {
        // 得到鼠标指针的位置
        let x = ev.clientX;
        let y = ev.clientY;
        new Ball(x, y);
    }
</script>
</body>
</html>